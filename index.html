<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage Handler</title>
    <style>
        button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>LocalStorage Demo</h1>
    <button onclick="clearLocalStorage('source')">Clear Source </button>
    <div id="output"></div>
    <script>

        function clearLocalStorage(key){
            localStorage.setItem(key, null );
        }
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        function handleLocalStorage() {
            const action = getParameterByName('action');
            const source = getParameterByName('source');
            const platform = getParameterByName('platform');
            const output = document.getElementById('output');

            if (action === 'write') {
                if(source)
                {
                    localStorage.setItem('source', source);
                    output.textContent = 'Data written to localStorage: ' + source;
                }
                if(platform)
                {
                    localStorage.setItem('platform', platform);
                
                    if(platform === 'android'){
                        window.location.href = 'https://play.google.com/store/apps/details?id=com.gn.khogame&referrer=utm_source%3Dopenwebview%2Fhttps%3A%2F%2Fkendevg88.github.io%2Fvm';
                    }
                    else if(platform === 'ios'){
                        window.location.href = 'https://apps.apple.com/app/id6502967054';
                    }
                }
                window.location.href = "https://go88vm.com";
            } else if (action === 'read') {
                const storedSource = localStorage.getItem('source');
                if (storedSource & storedSource != "") {
                    output.textContent = 'Data retrieved from localStorage: ' + storedSource;
                    window.location.href = 'external@com.gn.khogame://openwebview/https://kendevg88.github.io/vm?source=' + storedSource; 
                } else {
                    output.textContent = 'No data found in localStorage.';
                }
            } else {
                output.textContent = 'Invalid action or source parameter.';
            }
        }

        handleLocalStorage();
    </script>
</body>
</html>